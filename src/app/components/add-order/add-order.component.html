<div class="container">
  <h1 class="mt-4 mb-2 ms-3 fs-1">
    {{ isEditMode ? "Update Order" : "Add Order" }}
  </h1>

  <div class="container rounded-4 p-5 m-auto bg-white shadow">
    <form [formGroup]="orderForm" (ngSubmit)="handleForm()">
      <div class="row">
        <div class="mb-3 col-md-6">
          <label for="orderType" class="form-label">Order Type :</label>
          <select
            name="orderType"
            class="form-select"
            id="orderType"
            formControlName="orderType"
            #inputOrderType
          >
            @for (option of orderTypeOptions; track $index) {
            <option [value]="option" class="text-capitalize">
              {{ option }}
            </option>
            }
          </select>
          @if (orderForm.get("orderType")?.errors &&
          (orderForm.get("orderType")?.touched || inputOrderType.value.length >
          0)) {
          <div class="alert alert-danger">
            @if (orderForm.get("orderType")?.getError("required")) {
            <p>Order Type Required</p>
            }
          </div>
          }
        </div>

        <div class="mb-3 col-md-6">
          <label for="clientName" class="form-label">Client Name :</label>
          <input
            type="text"
            class="form-control"
            id="clientName"
            formControlName="clientName"
            #inputclientName
          />
          @if ( orderForm.get('clientName')?.errors &&
          (orderForm.get('clientName')?.touched || inputclientName.value.length
          > 0) ) {
          <div class="alert alert-danger mt-2">
            @if (orderForm.get('clientName')?.getError('required')) {
            <p>Client Name Required</p>
            }
          </div>
          }
        </div>

        <div class="mb-3 col-md-6">
          <label for="phone1" class="form-label">Phone Number :</label>
          <input
            #phone1
            type="text"
            class="form-control"
            id="phone1"
            formControlName="phone1"
          />
          @if ( orderForm.get('phone1')?.errors &&
          (orderForm.get('phone1')?.touched || phone1.value.length > 0) ) {
          <div class="alert alert-danger mt-2">
            @if (orderForm.get('phone1')?.getError('required')) {
            <p>Client Phone Required</p>
            }
          </div>
          }
        </div>

        <div class="mb-3 col-md-6">
          <label for="email" class="form-label">Email :</label>
          <input
            #inputEmail
            type="email"
            class="form-control"
            id="email"
            formControlName="email"
          />
          @if ( orderForm.get('email')?.errors &&
          (orderForm.get('email')?.touched || inputEmail.value.length > 0) ) {
          <div class="alert alert-danger mt-2">
            @if (orderForm.get('email')?.getError('required')) {
            <p>Email Required</p>
            } @if (orderForm.get('email')?.getError('email')) {
            <p>Email Invalid</p>
            }
          </div>
          }
        </div>

        <div class="mb-3 col-md-6">
          <label for="governrate" class="form-label">Governorate : </label>
          <select
            name="governrate"
            id="governrate"
            class="form-select"
            formControlName="governorate_id"
            #inputGovernrate
          >
            @for (governrate of governrates; track $index) {
            <option [value]="governrate.id">{{ governrate.name }}</option>
            }
          </select>
          @if (orderForm.get("governorate_id")?.errors &&
          (orderForm.get("governorate_id")?.touched ||
          inputGovernrate.value.length > 0)) {
          <div class="alert alert-danger">
            @if (orderForm.get("governorate_id")?.getError("required")) {
            <p>Governorate Name Required</p>
            }
          </div>
          }
        </div>

        <div class="mb-3 col-md-6">
          <label for="city" class="form-label">City : </label>
          <select
            name="city"
            id="city"
            class="form-select"
            formControlName="city_id"
            #inputCity
          >
            @for (city of cities; track $index) {
            <option [value]="city.id">{{ city.city_name }}</option>
            }
          </select>
          @if (orderForm.get("city_id")?.errors &&
          (orderForm.get("city_id")?.touched || inputCity.value.length > 0)) {
          <div class="alert alert-danger">
            @if (orderForm.get("city_id")?.getError("required")) {
            <p>City Required</p>
            }
          </div>
          }
        </div>

        <div class="mb-3 col-md-6">
          <label for="village" class="form-label">Village & Street :</label>
          <input
            type="text"
            class="form-control"
            id="village"
            formControlName="village"
          />

          <div class="mb-3 form-check">
            <input
              type="checkbox"
              class="form-check-input"
              id="toVillage"
              formControlName="toVillage"
            />
            <label class="form-check-label" for="toVillage"
              >Deliver To Village</label
            >
          </div>
        </div>

        <div class="mb-3 col-md-6">
          <label for="shipingTypeInput" class="form-label"
            >Shipping Type :</label
          >
          <select
            name="shippingType"
            class="form-select"
            id="shipingTypeInput"
            formControlName="shippingType"
            #inputShippingType
          >
            @for (item of shippingTypeOptions; track $index) {
            <option [value]="item">{{ item }}</option>
            }
          </select>
          @if (orderForm.get("shippingType")?.errors &&
          (orderForm.get("shippingType")?.touched ||
          inputShippingType.value.length > 0)) {
          <div class="alert alert-danger">
            @if (orderForm.get("shippingType")?.getError("required")) {
            <p>Shipping Type Required</p>
            }
          </div>
          }
        </div>

        <div class="mb-3 col-md-6">
          <label for="paymentTypeInput" class="form-label"
            >Payment Type :</label
          >
          <select
            name="paymentType"
            class="form-select"
            id="paymentTypeInput"
            formControlName="paymentType"
            #inputPaymentType
          >
            @for (item of paymentTypeOptions; track $index) {
            <option [value]="item">{{ item }}</option>
            }
          </select>
          @if (orderForm.get("paymentType")?.errors &&
          (orderForm.get("paymentType")?.touched ||
          inputPaymentType.value.length > 0)) {
          <div class="alert alert-danger">
            @if (orderForm.get("paymentType")?.getError("required")) {
            <p>Payment Type Required</p>
            }
          </div>
          }
        </div>

        <div class="mb-3 col-md-6">
          <label for="branch" class="form-label">Branch :</label>
          <select
            name="branch"
            class="form-select"
            id="branch"
            formControlName="branch_id"
            #inputBranch
          >
            @for (branch of branches; track $index) {
            <option [value]="branch.id">{{ branch.name }}</option>
            }
          </select>
          @if (orderForm.get("branch_id")?.errors &&
          (orderForm.get("branch_id")?.touched || inputBranch.value.length > 0))
          {
          <div class="alert alert-danger">
            @if (orderForm.get("branch_id")?.getError("required")) {
            <p>Branch Required</p>
            }
          </div>
          }
        </div>

        <hr class="my-2" />
        <h4 class="my-2">Add Product</h4>

        <form [formGroup]="productForm" (ngSubmit)="addProduct()" class="row">
          <div class="mb-3 col-md-4">
            <label for="productName" class="form-label">Product Name :</label>
            <input
              #productName
              type="text"
              class="form-control"
              id="productName"
              formControlName="productName"
            />
          </div>
          <div class="mb-3 col-md-4">
            <label for="productQuantity" class="form-label">Quantity :</label>
            <input
              type="number"
              class="form-control"
              id="productQuantity"
              formControlName="productQuantity"
            />
          </div>
          <div class="mb-3 col-md-4">
            <label for="productWeight" class="form-label">Weight :</label>
            <input
              type="number"
              class="form-control"
              id="productWeight"
              formControlName="productWeight"
            />
          </div>
          <div class="d-flex justify-content-end">
            <button type="submit" class="btn">Add Product</button>
          </div>
        </form>

        <!-- Products Table -->
        <div class="my-3">
          <h4>Product List</h4>
          <table class="table text-center">
            <thead>
              <tr>
                <th class="left">#</th>
                <th>Product Name</th>
                <th>Quantity</th>
                <th>Weight</th>
                <th class="right">Action</th>
              </tr>
            </thead>
            <tbody>
              @for(product of products.controls; track $index){
              <tr>
                <td>{{ $index + 1 }}</td>
                <td>{{ product.get("productName")?.value }}</td>
                <td>{{ product.get("productQuantity")?.value }}</td>
                <td>{{ product.get("productWeight")?.value }}</td>
                <td>
                  <button
                    type="button"
                    class="btn btn-danger btn-sm"
                    (click)="removeProduct($index)"
                  >
                    Remove
                  </button>
                </td>
              </tr>
              }
            </tbody>
          </table>
        </div>
        <div class="mb-3 col-md-6">
          <label for="cost" class="form-label">Order Cost :</label>
          <input
            #cost
            type="number"
            class="form-control"
            id="cost"
            formControlName="cost"
          />
        </div>
        <div class="mb-3 col-md-6">
          <label for="weight" class="form-label">Total Weight :</label>
          <input
            #weight
            type="number"
            class="form-control"
            id="weight"
            formControlName="weight"
          />
        </div>
        <div class="mb-3 col-md-12">
          <label for="notes" class="form-label">Notes :</label>
          <textarea
            #notes
            type="number"
            class="form-control"
            id="notes"
            formControlName="notes"
          >
          </textarea>
        </div>

        <hr class="my-2" />
        <h4 class="my-2">Merchant Data</h4>
        <div class="mb-3 col-md-6">
          <label for="merchantPhone" class="form-label">Phone Number :</label>
          <input
            #merchantPhone
            type="text"
            class="form-control"
            id="merchantPhone"
            formControlName="trader_phone"
          />
          @if ( orderForm.get('trader_phone')?.errors &&
          (orderForm.get('trader_phone')?.touched || merchantPhone.value.length
          > 0) ) {
          <div class="alert alert-danger mt-2">
            @if (orderForm.get('trader_phone')?.getError('required')) {
            <p>Merchant Phone Required</p>
            }
          </div>
          }
        </div>

        <div class="mb-3 col-md-6">
          <label for="merchantAddress" class="form-label">Address :</label>
          <input
            #merchantAddress
            type="text"
            class="form-control"
            id="merchantAddress"
            formControlName="trader_address"
          />
          @if ( orderForm.get('trader_address')?.errors &&
          (orderForm.get('trader_address')?.touched ||
          merchantAddress.value.length > 0) ) {
          <div class="alert alert-danger mt-2">
            @if (orderForm.get('trader_address')?.getError('required')) {
            <p>Merchant Address Required</p>
            }
          </div>
          }
        </div>
      </div>
      <div class="d-flex justify-content-end">
        <button type="submit" class="btn">
          {{ isEditMode ? "Update Order" : "Add Order" }}
        </button>
      </div>
    </form>
  </div>
</div>
